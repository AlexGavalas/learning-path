---
import { DEFAULT_THEME, STORAGE_KEY, THEME } from '~constants';
---

<script is:inline define:vars={{ DEFAULT_THEME, STORAGE_KEY, THEME }}>
if (typeof document !== 'undefined') {
    const getTheme = () => {
        if (typeof localStorage === 'undefined') {
            return DEFAULT_THEME;
        }

        const storedTheme = localStorage.getItem(STORAGE_KEY.THEME);

        if (storedTheme) {
            return storedTheme;
        }

        const prefersDarkColorScheme = window.matchMedia(
            '(prefers-color-scheme: dark)',
        ).matches;

        if (prefersDarkColorScheme) {
            return THEME.DARK;
        }

        return DEFAULT_THEME;
    };

    const setupTheme = () => {
        const theme = getTheme();

        document.documentElement.classList.toggle(
            'dark',
            theme === THEME.DARK,
        );
        document.documentElement.style.setProperty('color-scheme', theme);

        window.localStorage.setItem(STORAGE_KEY.THEME, theme);
    };

    setupTheme();

    document.addEventListener('astro:after-swap', setupTheme);
}
</script>
