---
import Button from '~components/button/button.astro';
import * as cn from './copy-to-clipboard.css';

interface Props {
    prefix?: string;
}

const { prefix } = Astro.props;
---

<copy-to-clipboard class={cn.container}>
    {prefix ? `${prefix} - ` : ''}
    <Button class={cn.buttonCn}>Copy to clipboard</Button>
    <div id="target">
        <slot />
    </div>
</copy-to-clipboard>

<script>
    import { container } from './copy-to-clipboard.css';

    class CopyToClipboard extends HTMLElement {
        copyToClipboard() {
            const targetText =
                this.querySelector('#target')?.textContent?.trim();

            if (targetText) {
                navigator.clipboard.writeText(targetText);
            }
        }

        connectedCallback() {
            this.classList.remove(container);
            this.addEventListener('click', this.copyToClipboard);
        }

        disconnectedCallback() {
            this.removeEventListener('click', this.copyToClipboard);
        }
    }

    customElements.define('copy-to-clipboard', CopyToClipboard);
</script>
